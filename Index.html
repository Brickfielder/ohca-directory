<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UK Cardiac Arrest Centres Map</title>
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <style>
      html, body {
        height: 100%;
        margin: 0;
      }
      #map {
        width: 100%;
        height: 100%;
      }
      .popup-content {
        font-family: Arial, sans-serif;
        font-size: 14px;
        line-height: 1.4;
      }
      .popup-content strong {
        font-size: 16px;
      }
      .popup-section {
        margin-bottom: 8px;
      }
    </style>
</head>
<body>
    <div id="map"></div>
    <div id="search-container" style="position: absolute; top: 10px; left: 50px; z-index: 1000; background: rgba(255,255,255,0.9); padding: 5px 8px; border-radius: 4px; box-shadow: 0 0 6px rgba(0,0,0,0.3);">
      <input type="text" id="search-box" placeholder="Search services..." style="width: 200px; padding: 4px; font-size: 14px;" list="services-list" />
      <datalist id="services-list"></datalist>
    </div>
    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script>
      const hospitals = [
  {
    "id": "golden-jubilee-university-hospital",
    "name": "Golden Jubilee University Hospital",
    "lat": 55.9035,
    "lng": -4.4026,
    "postcode": "G81 4HX",
    "phone": "01389 815000",
    "eligibility": "Not specified"
  },
  {
    "id": "queen-elizabeth-university-hospital-glasgow",
    "name": "Queen Elizabeth University Hospital",
    "lat": 55.8275,
    "lng": -4.3060,
    "postcode": "G51 4TF",
    "phone": "0141 314 3140",
    "eligibility": "Not specified"
  },
  {
    "id": "royal-infirmary-of-edinburgh",
    "name": "Royal Infirmary of Edinburgh",
    "lat": 55.9384,
    "lng": -3.1840,
    "postcode": "EH16 4SA",
    "phone": "0131 536 1000",
    "eligibility": "Not specified"
  },
  {
    "id": "aberdeen-royal-infirmary",
    "name": "Aberdeen Royal Infirmary",
    "lat": 57.1495,
    "lng": -2.0973,
    "postcode": "AB25 2ZN",
    "phone": "01224 558888",
    "eligibility": "Not specified"
  },
  {
    "id": "altnagelvin-area-hospital",
    "name": "Altnagelvin Area Hospital",
    "lat": 54.985,
    "lng": -7.295,
    "postcode": "BT47 6SB",
    "phone": "028 7134 5171",
    "eligibility": "Not specified"
  },
  {
    "id": "barts-heart-centre",
    "name": "Barts Heart Centre (St Bartholomew\u2019s Hospital)",
    "lat": 51.5175,
    "lng": -0.1001,
    "postcode": "EC1A 7BE",
    "phone": "020 7377 7000",
    "eligibility": "Not specified"
  },
  {
    "id": "bristol-heart-institute",
    "name": "Bristol Heart Institute (Bristol Royal Infirmary)",
    "lat": 51.459,
    "lng": -2.5963,
    "postcode": "BS2 8HW",
    "phone": "0117 923 0000",
    "eligibility": "Not specified"
  },
  {
    "id": "derriford-hospital",
    "name": "Derriford Hospital (Plymouth)",
    "lat": 50.4162,
    "lng": -4.1141,
    "postcode": "PL6 8DH",
    "phone": "01752 202082",
    "eligibility": "Not specified"
  },
  {
    "id": "essex-cardiothoracic-centre",
    "name": "Essex Cardiothoracic Centre (Basildon Hospital)",
    "lat": 51.5579,
    "lng": 0.4517,
    "postcode": "SS16 5NL",
    "phone": "01268 524900",
    "eligibility": "Patients admitted with an out-of-hospital cardiac arrest",
    "followUp": "Yes (CARE Clinic)",
    "description": "Every patient (\"survivor\") will be contacted between 3 and 6 months after discharge for a follow-up. A relative is invited as well. The survivor will be offered a holistic assessment with a specialist ICU (intensive care unit) nurse that will cover physical recovery, as well as memory/thinking skills and mood. The family member will also be offered a review of their own recovery. Referrals will be made to external services as required.",
    "source": "Dr Marco Mion (CARE Clinic)"
  },
  {
    "id": "freeman-hospital",
    "name": "Freeman Hospital (Newcastle upon Tyne)",
    "lat": 55.002,
    "lng": -1.594,
    "postcode": "NE7 7DN",
    "phone": "0191 233 6161",
    "eligibility": "Not specified"
  },
  {
    "id": "glenfield-hospital",
    "name": "Glenfield Hospital (Leicester)",
    "lat": 52.65524,
    "lng": -1.17961,
    "postcode": "LE3 9QP",
    "phone": "0300 303 1573",
    "eligibility": "Not specified"
  },
  {
    "id": "hammersmith-hospital",
    "name": "Hammersmith Hospital (London)",
    "lat": 51.517422,
    "lng": -0.234698,
    "postcode": "W12 0HS",
    "phone": "020 3311 3311",
    "eligibility": "Not specified"
  },
  {
    "id": "harefield-hospital",
    "name": "Harefield Hospital (Uxbridge)",
    "lat": 51.60711,
    "lng": -0.4852,
    "postcode": "UB9 6JH",
    "phone": "01895 823737",
    "eligibility": "Not specified"
  },
  {
    "id": "james-cook-university-hospital",
    "name": "James Cook University Hospital (Middlesbrough)",
    "lat": 54.552,
    "lng": -1.214,
    "postcode": "TS4 3BW",
    "phone": "01642 850850",
    "eligibility": "Not specified"
  },
  {
    "id": "john-radcliffe-hospital",
    "name": "John Radcliffe Hospital (Oxford)",
    "lat": 51.76361,
    "lng": -1.21861,
    "postcode": "OX3 9DU",
    "phone": "0300 304 7777",
    "eligibility": "Not specified"
  },
  {
    "id": "morriston-hospital",
    "name": "Morriston Hospital (Swansea)",
    "lat": 51.68417,
    "lng": -3.93472,
    "postcode": "SA6 6NL",
    "phone": "01792 702222",
    "eligibility": "Not specified"
  },
  {
    "id": "northern-general-hospital",
    "name": "Northern General Hospital (Sheffield)",
    "lat": 53.41083,
    "lng": -1.45833,
    "postcode": "S5 7AU",
    "phone": "0114 243 4343",
    "eligibility": "Not specified"
  },
  {
    "id": "st-thomas-hospital",
    "name": "St Thomas\u2019 Hospital (London)",
    "lat": 51.49796,
    "lng": -0.11888,
    "postcode": "SE1 7EH",
    "phone": "020 7188 7188",
    "eligibility": "Not specified"
  },
  {
    "id": "kings-college-hospital",
    "name": "King\u2019s College Hospital (London)",
    "lat": 51.468078,
    "lng": -0.09389,
    "postcode": "SE5 9RS",
    "phone": "020 3299 9000",
    "eligibility": "Not specified"
  },
  {
    "id": "st-georges-hospital",
    "name": "St George\u2019s Hospital (London)",
    "lat": 51.426682,
    "lng": -0.175694,
    "postcode": "SW17 0QT",
    "phone": "020 8672 1255",
    "eligibility": "Not specified"
  },
  {
    "id": "royal-free-hospital",
    "name": "Royal Free Hospital (London)",
    "lat": 51.553227,
    "lng": -0.165298,
    "postcode": "NW3 2QG",
    "phone": "020 7830 2127",
    "eligibility": "Not specified"
  },
  {
    "id": "royal-papworth-hospital",
    "name": "Royal Papworth Hospital (Cambridge)",
    "lat": 52.173618,
    "lng": 0.135626,
    "postcode": "CB2 0AY",
    "phone": "01223 638000",
    "eligibility": "Not specified"
  },
  {
    "id": "queen-elizabeth-hospital",
    "name": "Queen Elizabeth Hospital (Birmingham)",
    "lat": 52.453198,
    "lng": -1.938471,
    "postcode": "B15 2TH",
    "phone": "0121 371 2000",
    "eligibility": "Not specified"
  },
  {
    "id": "manchester-heart-centre",
    "name": "Manchester Heart Centre (Manchester Royal Infirmary)",
    "lat": 53.462452,
    "lng": -2.227709,
    "postcode": "M13 9WL",
    "phone": "0161 276 1234",
    "eligibility": "Not specified"
  },
  {
    "id": "wythenshawe-hospital",
    "name": "Wythenshawe Hospital (Manchester)",
    "lat": 53.387938,
    "lng": -2.293183,
    "postcode": "M23 9LT",
    "phone": "0161 998 7070",
    "eligibility": "Not specified"
  },
  {
    "id": "liverpool-heart-and-chest-hospital",
    "name": "Liverpool Heart and Chest Hospital",
    "lat": 53.411167,
    "lng": -2.897989,
    "postcode": "L14 3PE",
    "phone": "0151 600 1953",
    "eligibility": "Not specified"
  },
  {
    "id": "royal-stoke-university-hospital",
    "name": "Royal Stoke University Hospital (Stoke-on-Trent)",
    "lat": 53.003262,
    "lng": -2.211798,
    "postcode": "ST4 6QG",
    "phone": "01782 715444",
    "eligibility": "Not specified"
  },
  {
    "id": "leeds-general-infirmary",
    "name": "Leeds General Infirmary (Leeds)",
    "lat": 53.801461,
    "lng": -1.551748,
    "postcode": "LS1 3EX",
    "phone": "0113 243 2799",
    "eligibility": "Not specified"
  },
  {
    "id": "royal-sussex-county-hospital",
    "name": "Royal Sussex County Hospital (Brighton)",
    "lat": 50.819462,
    "lng": -0.118149,
    "postcode": "BN2 5BE",
    "phone": "01273 696955",
    "eligibility": "Not specified"
  },
  {
    "id": "southampton-general-hospital",
    "name": "Southampton General Hospital (Southampton)",
    "lat": 50.933011,
    "lng": -1.435095,
    "postcode": "SO16 6YD",
    "phone": "023 8077 7222",
    "eligibility": "Not specified"
  },
  {
    "id": "university-hospital-of-wales",
    "name": "University Hospital of Wales (Cardiff)",
    "lat": 51.507156,
    "lng": -3.189855,
    "postcode": "CF14 4XW",
    "phone": "029 2074 7747",
    "eligibility": "Not specified"
  },
  {
    "id": "royal-victoria-hospital",
    "name": "Royal Victoria Hospital (Belfast)",
    "lat": 54.594237,
    "lng": -5.954027,
    "postcode": "BT12 6BA",
    "phone": "028 9024 0503",
    "eligibility": "Not specified"
  },
  {
    "id": "norfolk-norwich-university-hospital",
    "name": "Norfolk and Norwich University Hospital",
    "lat": 52.617,
    "lng": 1.22,
    "postcode": "NR4 7UY",
    "phone": "01603 286286",
    "eligibility": "Not specified"
  }
];

      const airAmbulances = [
  {
    "id": "air-ambulance-northern-ireland",
    "name": "Air Ambulance Northern Ireland",
    "lat": 54.488765,
    "lng": -6.092659,
    "postcode": "BT27 5RF",
    "followUp": "No (informal only)",
    "eligibility": "Not specified",
    "description": "No dedicated aftercare programme; the charity encourages former patients to share their stories and connect via community events.",
    "contact": "Email: info@airambulanceni.org | Tel: 02892622677",
    "sourceLink": "https://airambulanceni.org"
  },
  {
    "id": "cornwall-air-ambulance-trust",
    "name": "Cornwall Air Ambulance Trust",
    "lat": 50.432492,
    "lng": -4.984158,
    "postcode": "TR8 4DY",
    "followUp": "No (informal only)",
    "eligibility": "Not specified",
    "description": "No formal aftercare programme; encourages former patients to share their stories and stay in touch.",
    "contact": "Email: enquiries@cornwallairambulancetrust.org | Tel: 01637 889926",
    "sourceLink": "https://cornwallairambulancetrust.org"
  },
  {
    "id": "devon-air-ambulance-trust",
    "name": "Devon Air Ambulance Trust",
    "lat": 50.740825,
    "lng": -3.481858,
    "postcode": "EX4 8NS",
    "followUp": "Yes",
    "eligibility": "Not specified",
    "description": "The Patient & Family Support service offers practical and emotional support after an incident, answering questions, signposting to resources and connecting survivors.",
    "contact": "Email: patientsupport@daat.org | Tel: 01392 466 666",
    "sourceLink": "https://www.daat.org"
  },
  {
    "id": "dorset-somerset-air-ambulance",
    "name": "Dorset & Somerset Air Ambulance",
    "lat": 50.983973,
    "lng": -3.200976,
    "postcode": "TA21 9JQ",
    "followUp": "Yes",
    "eligibility": "Not specified",
    "description": "Dedicated Patient & Family Liaison Nurses provide follow‑up care, answering questions and supporting recovery.",
    "contact": "Email: dsaa.support@nhs.net",
    "sourceLink": "https://www.dsairambulance.org.uk"
  },
  {
    "id": "east-anglian-air-ambulance",
    "name": "East Anglian Air Ambulance",
    "lat": 52.673176,
    "lng": 1.269394,
    "postcode": "NR6 6EG",
    "followUp": "Yes",
    "eligibility": "Not specified",
    "description": "The Aftercare Team offers support for patients, bystanders and families, including bereavement support and help filling gaps in memory. They provide a listening ear and signposting to community services.",
    "contact": "Email: aftercare@eaaa.org.uk | Tel: 01223 403 600",
    "sourceLink": "https://www.eaaa.org.uk"
  },
  {
    "id": "essex-herts-air-ambulance",
    "name": "Essex & Herts Air Ambulance",
    "lat": 51.907739,
    "lng": 0.682331,
    "postcode": "CO6 2NS",
    "followUp": "Yes",
    "eligibility": "Not specified",
    "description": "Two Patient Liaison Managers offer emotional and bereavement support and can help families understand what happened.",
    "contact": "Email: reception@ehaat.org | Tel: 0345 241 7690",
    "sourceLink": "https://www.ehaat.org"
  },
  {
    "id": "great-north-air-ambulance-service",
    "name": "Great North Air Ambulance Service",
    "lat": 54.525374,
    "lng": -1.380925,
    "postcode": "TS16 0QB",
    "followUp": "No (no formal programme)",
    "eligibility": "Not specified",
    "description": "No formal aftercare programme; supporters and patients can contact the charity via general channels for information.",
    "contact": "Email: info@greatnorthairambulance.co.uk | Tel: 01325 487263",
    "sourceLink": "https://www.greatnorthairambulance.co.uk"
  },
  {
    "id": "great-western-air-ambulance-charity",
    "name": "Great Western Air Ambulance Charity",
    "lat": 51.439988,
    "lng": -2.62809,
    "postcode": "BS3 2JH",
    "followUp": "Yes",
    "eligibility": "Not specified",
    "description": "The Patient Support service, delivered by a dedicated nurse, provides follow‑up care and support, answering questions and signposting to additional services.",
    "contact": "Tel: 0303 4444 999",
    "sourceLink": "https://greatwesternairambulance.com"
  },
  {
    "id": "hampshire-isle-of-wight-air-ambulance",
    "name": "Hampshire & Isle of Wight Air Ambulance",
    "lat": 50.941027,
    "lng": -1.470438,
    "postcode": "SO16 0BT",
    "followUp": "Yes",
    "eligibility": "Not specified",
    "description": "The Aftercare Team provides ongoing support and signposting; Aftercare Managers like Nikki Harris and Laura serve as contacts for patients and families.",
    "contact": "Email: enquiries@hiowaa.org | Tel: 023 8074 3510",
    "sourceLink": "https://www.hiowaa.org"
  },
  {
    "id": "kent-surrey-sussex-air-ambulance",
    "name": "Kent, Surrey & Sussex Air Ambulance",
    "lat": 51.345221,
    "lng": 0.506497,
    "postcode": "ME5 9SD",
    "followUp": "Yes",
    "eligibility": "Not specified",
    "description": "The Patient and Family Aftercare Service (launched in 2022) offers support for patients and families, including debriefing, signposting and connecting survivors with crew members.",
    "contact": "Email: hello@aakss.org.uk | Tel: 01634 471 900",
    "sourceLink": "https://www.aakss.org.uk"
  },
  {
    "id": "lincs-notts-air-ambulance",
    "name": "Lincs & Notts Air Ambulance",
    "lat": 53.171989,
    "lng": -0.50793,
    "postcode": "LN4 2GW",
    "followUp": "Yes",
    "eligibility": "Not specified",
    "description": "The Aftercare Team provides personalised support via phone and email check‑ins, answering questions and signposting to support groups.",
    "contact": "Email: support@ambucopter.org.uk | Tel: 01522 548469",
    "sourceLink": "https://www.ambucopter.org.uk"
  },
  {
    "id": "londons-air-ambulance-charity",
    "name": "London\u2019s Air Ambulance Charity",
    "lat": 51.512491,
    "lng": -0.072883,
    "postcode": "E1 8AN",
    "followUp": "Yes",
    "eligibility": "Not specified",
    "description": "Patient Liaison Nurses from Barts Health (including Frank Chege and Eleanor Overgaard‑Brown) provide aftercare support, debriefing patients and offering signposting since 2014.",
    "contact": "Email: PLN@londonsairambulance.org.uk",
    "sourceLink": "https://www.londonsairambulance.org.uk"
  },
  {
    "id": "magpas-air-ambulance",
    "name": "Magpas Air Ambulance",
    "lat": 52.37736,
    "lng": -0.248827,
    "postcode": "PE28 4YF",
    "followUp": "No (informal only)",
    "eligibility": "Not specified",
    "description": "No formal aftercare; survivors can connect via the charity’s Facebook community and communications team.",
    "contact": "Email: info@magpas.org | Tel: 01480 371060",
    "sourceLink": "https://www.magpas.org.uk"
  },
  {
    "id": "midlands-air-ambulance-charity",
    "name": "Midlands Air Ambulance Charity",
    "lat": 52.64712,
    "lng": -2.314772,
    "postcode": "TF11 8UR",
    "followUp": "Yes",
    "eligibility": "Not specified",
    "description": "The Patient Liaison & Aftercare Service (launched April 2024) offers follow‑up support, with Patient Liaison Leads Kerry Hemus and Rob Davies providing information, guidance and signposting to additional services.",
    "contact": "Email: patient.liaison@midlandsairambulance.com | Tel: 0800 8 40 20 40",
    "sourceLink": "https://www.midlandsairambulance.com"
  },
  {
    "id": "north-west-air-ambulance-charity",
    "name": "North West Air Ambulance Charity",
    "lat": 53.489772,
    "lng": -2.850378,
    "postcode": "L33 7UY",
    "followUp": "Yes",
    "eligibility": "Not specified",
    "description": "The Aftercare Service is delivered in collaboration with major trauma centres to support patients and families after an incident.",
    "contact": "Email: enquiries@nwairambulance.org.uk | Tel: 0800 587 4570",
    "sourceLink": "https://www.nwaa.net"
  },
  {
    "id": "scotlands-charity-air-ambulance",
    "name": "Scotland\u2019s Charity Air Ambulance",
    "lat": 56.435128,
    "lng": -3.37423,
    "postcode": "PH2 6PL",
    "followUp": "No (no programme)",
    "eligibility": "Not specified",
    "description": "No dedicated aftercare programme; survivors can seek support via partner organisations and NHS services.",
    "contact": "Email: getinvolved@scaa.org.uk | Tel: 0300 123 1111",
    "sourceLink": "https://www.scaa.org.uk"
  },
  {
    "id": "thames-valley-air-ambulance",
    "name": "Thames Valley Air Ambulance",
    "lat": 51.65,
    "lng": -0.9,
    "postcode": "HP14 3SX",
    "followUp": "Yes",
    "eligibility": "Not specified",
    "description": "The Patient and Family Aftercare programme, expanded in 2022, offers comprehensive support including home visits, debriefs, signposting and peer connections.",
    "contact": "Email: aftercare@tvairambulance.org.uk | Tel: 0300 999 0135",
    "sourceLink": "https://www.tvairambulance.org.uk"
  },
  {
    "id": "air-ambulance-service",
    "name": "The Air Ambulance Service (WNAA & DLRAA)",
    "lat": 52.371,
    "lng": -1.267,
    "postcode": "CV21 3RQ",
    "followUp": "Yes",
    "eligibility": "Not specified",
    "description": "The Patient & Family aftercare programme is led by Clinical Liaison Officer Justine Alexander, providing support, information and follow‑up for patients and families.",
    "contact": "Email: aftercare@theairambulanceservice.org.uk | Tel: 0300 3045 999",
    "sourceLink": "https://theairambulanceservice.org.uk"
  },
  {
    "id": "wales-air-ambulance",
    "name": "Wales Air Ambulance Charity",
    "lat": 51.684,
    "lng": -4.132,
    "postcode": "SA14 8LQ",
    "followUp": "Yes",
    "eligibility": "Not specified",
    "description": "A robust aftercare support programme led by patient liaison nurses Jo Yeoman and Hayley Whitehead offers practical and emotional support, help with paperwork, and signposting to community services.",
    "contact": "Email: emrts.patient@wales.nhs.uk | Tel: 0300 300 0067",
    "sourceLink": "https://www.walesairambulance.com"
  },
  {
    "id": "wiltshire-air-ambulance",
    "name": "Wiltshire Air Ambulance",
    "lat": 51.333,
    "lng": -2.161,
    "postcode": "BA14 6JX",
    "followUp": "Yes",
    "eligibility": "Not specified",
    "description": "The Aftercare Support Team provides ongoing support, answering questions about treatment and signposting to local and national resources.",
    "contact": "Tel: 01225 300536",
    "sourceLink": "https://www.wiltshireairambulance.co.uk"
  },
  {
    "id": "yorkshire-air-ambulance",
    "name": "Yorkshire Air Ambulance",
    "lat": 53.694,
    "lng": -1.832,
    "postcode": "HX5 0HQ",
    "followUp": "Yes",
    "eligibility": "Not specified",
    "description": "The patient and family support initiative offers dedicated support, including home visits, memory recall and connecting survivors with crew. Patient liaison nurses work closely with survivors and their families.",
    "contact": "Email: patientcare@yaa.org.uk | Tel: 01422 237900",
    "sourceLink": "https://www.yorkshireairambulance.org.uk"
  }
];

      // Charities supporting survivors and bystanders of cardiac arrest.  Each
      // entry includes approximate coordinates (based on postcode or head‑office
      // address), a brief description of the organisation’s role, contact
      // details and a source link to the relevant website.
      const charities = [
        {
          id: "save-a-life-for-scotland",
          name: "Save a Life for Scotland (SALFS)",
          lat: 55.9209289,
          lng: -3.1394165,
          description: "A partnership programme that trains people across Scotland in CPR and provides resources for survivors and bystanders. It brings together charities and emergency services to improve out‑of‑hospital cardiac arrest outcomes.",
          contact: "Email: hello@savealife.scot",
          sourceLink: "https://www.savealife.scot"
        },
        {
          id: "chest-heart-stroke-scotland",
          name: "Chest Heart & Stroke Scotland (CHSS)",
          lat: 55.9539613,
          lng: -3.1978848,
          description: "Provides a free, confidential Advice Line offering information and emotional support for people affected by chest, heart and stroke conditions, their families and bystanders.",
          contact: "Email: adviceline@chss.org.uk | Tel: 0808 801 0899",
          sourceLink: "https://www.chss.org.uk"
        },
        {
          id: "scottish-ambulance-ohca-aftercare",
          name: "Scottish Ambulance Service – OHCA After‑care (SALFS partnership)",
          lat: 55.9300758,
          lng: -3.2992542,
          description: "Through the Save a Life for Scotland partnership, the Scottish Ambulance Service runs an out‑of‑hospital cardiac arrest after‑care project. It provides bystander CPR training, supports survivors and families, and signposts to partner organisations such as CHSS.",
          contact: "Email: adviceline@chss.org.uk | Tel: 0808 801 0899",
          sourceLink: "https://www.scottishambulance.com"
        },
        {
          id: "save-a-life-cymru",
          name: "Save a Life Cymru",
          lat: 51.53455,
          lng: -3.26105,
          description: "A national initiative in Wales that promotes CPR awareness and public access defibrillation, encouraging communities to learn lifesaving skills.",
          contact: "Email: SaveALifeCymru@wales.nhs.uk",
          sourceLink: "https://gov.wales/save-a-life-cymru"
        },
        {
          id: "welsh-ambulance-services-restartaheart",
          name: "Welsh Ambulance Services NHS Trust – Restart‑a‑Heart",
          lat: 53.25237,
          lng: -3.47857,
          description: "The Welsh Ambulance Services NHS Trust delivers the Restart‑a‑Heart campaign, teaching lifesaving CPR skills to the public and promoting bystander defibrillation. The charity also provides support and resources for survivors.",
          contact: "Email: amb_charity@wales.nhs.uk | Tel: 01745 532900",
          sourceLink: "https://www.ambulance.wales.nhs.uk"
        },
        {
          id: "british-heart-foundation",
          name: "British Heart Foundation – Heart Helpline",
          lat: 51.53344,
          lng: -0.13962,
          description: "The Heart Helpline connects callers with experienced cardiac nurses who can provide advice on heart and circulatory diseases, recovery after cardiac arrest, medication and lifestyle changes.",
          contact: "Email: hearthelpline@bhf.org.uk | Tel: 0808 802 1234",
          sourceLink: "https://www.bhf.org.uk"
        },
        {
          id: "bacpr",
          name: "British Association for Cardiovascular Prevention and Rehabilitation (BACPR)",
          lat: 51.5235694,
          lng: -0.1396953,
          description: "Provides education, professional training and resources to support cardiac rehabilitation and prevention across the UK.",
          contact: "Email: bacpr@bcs.com | Tel: +44 (0)20 7380 1907",
          sourceLink: "https://www.bacpr.com"
        },
        {
          id: "sudden-cardiac-arrest-uk",
          name: "Sudden Cardiac Arrest UK",
          lat: 51.5563655,
          lng: 0.5507963,
          description: "A peer support group and community for cardiac arrest survivors and their families, offering resources, forums and survivor stories.",
          contact: "Email: info@scauk.org | Tel: 0794 2288111",
          sourceLink: "https://www.suddencardiacarrestuk.org"
        },
        {
          id: "sads-uk",
          name: "SADS UK",
          lat: 51.56841,
          lng: 0.33875,
          description: "Supports families affected by sudden arrhythmic death and cardiac arrest, offering counselling, defibrillator placement and community education.",
          contact: "Email: sadsoffice@sadsuk.org | Tel: 01277 811215",
          sourceLink: "https://www.sadsuk.org"
        }
      ];

      const map = L.map('map').setView([54.5, -3], 6);

      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '© OpenStreetMap contributors'
      }).addTo(map);

      // Custom icons.  Use emojis rather than external libraries so the icons
      // render reliably when the file is opened offline.  Hospitals use the
      // hospital building emoji, air ambulances retain the helicopter emoji,
      // and charities are represented by a heart emoji.
      const hospitalIcon = L.divIcon({
        html: '<span style="font-size:24px">🏥</span>',
        className: '',
        iconSize: [24, 24],
        iconAnchor: [12, 12],
        popupAnchor: [0, -12]
      });
      const helicopterIcon = L.divIcon({
        html: '<span style="font-size:24px">🚁</span>',
        className: '',
        iconSize: [24, 24],
        iconAnchor: [12, 12],
        popupAnchor: [0, -12]
      });
      const charityIcon = L.divIcon({
        html: '<span style="font-size:24px">💗</span>',
        className: '',
        iconSize: [24, 24],
        iconAnchor: [12, 12],
        popupAnchor: [0, -12]
      });

      const markersLayer = new L.LayerGroup().addTo(map);
      const allMarkers = [];

      hospitals.forEach(hospital => {
        const marker = L.marker([hospital.lat, hospital.lng], {
          icon: hospitalIcon,
          title: hospital.name
        });
        const followUpText = hospital.followUp ? hospital.followUp : 'Not specified';
        const descText = hospital.description ? hospital.description : 'Hospital providing specialist cardiac arrest care.';
        const sourceText = hospital.source ? hospital.source : 'N/A';
        const popupContent = `
          <div class="popup-content">
            <div class="popup-section"><strong>${hospital.name}</strong></div>
            <div class="popup-section"><em>Follow-up care service offered:</em> ${followUpText}</div>
            <div class="popup-section"><em>Eligibility:</em> ${hospital.eligibility}</div>
            <div class="popup-section"><em>Description:</em> ${descText}</div>
            <div class="popup-section"><em>Contact:</em> Tel: <a href="tel:${hospital.phone.replace(/\s+/g, '')}">${hospital.phone}</a></div>
            <div class="popup-section"><em>Source:</em> ${sourceText}</div>
          </div>
        `;
        marker.bindPopup(popupContent);
        markersLayer.addLayer(marker);
        allMarkers.push({ name: hospital.name, marker: marker });
      });

      airAmbulances.forEach(service => {
        const marker = L.marker([service.lat, service.lng], {
          icon: helicopterIcon,
          title: service.name
        });
        const popupContent = `
          <div class="popup-content">
            <div class="popup-section"><strong>${service.name}</strong></div>
            <div class="popup-section"><em>Follow-up care service offered:</em> ${service.followUp}</div>
            <div class="popup-section"><em>Eligibility:</em> ${service.eligibility}</div>
            <div class="popup-section"><em>Description:</em> ${service.description}</div>
            <div class="popup-section"><em>Contact:</em> ${service.contact}</div>
            <div class="popup-section"><em>Source:</em> <a href="${service.sourceLink}" target="_blank">${service.sourceLink}</a></div>
          </div>
        `;
        marker.bindPopup(popupContent);
        markersLayer.addLayer(marker);
        allMarkers.push({ name: service.name, marker: marker });
      });

      // Add charity markers to the map.  These organisations provide
      // follow‑up care, education or peer support and are displayed with a
      // heart icon.  Include each in the search list so users can quickly find
      // them via the search box.
      charities.forEach(org => {
        const marker = L.marker([org.lat, org.lng], {
          icon: charityIcon,
          title: org.name
        });
        const popupContent = `
          <div class="popup-content">
            <div class="popup-section"><strong>${org.name}</strong></div>
            <div class="popup-section"><em>Description:</em> ${org.description}</div>
            <div class="popup-section"><em>Contact:</em> ${org.contact}</div>
            <div class="popup-section"><em>Source:</em> <a href="${org.sourceLink}" target="_blank">${org.sourceLink}</a></div>
          </div>
        `;
        marker.bindPopup(popupContent);
        markersLayer.addLayer(marker);
        allMarkers.push({ name: org.name, marker: marker });
      });

      const servicesList = document.getElementById('services-list');
      allMarkers.forEach(item => {
        const opt = document.createElement('option');
        opt.value = item.name;
        servicesList.appendChild(opt);
      });

      const searchBox = document.getElementById('search-box');
      function performSearch() {
        const query = searchBox.value.trim().toLowerCase();
        if (!query) return;
        const match = allMarkers.find(item => item.name.toLowerCase().includes(query));
        if (match) {
          const latlng = match.marker.getLatLng();
          map.setView(latlng, 11);
          match.marker.openPopup();
        }
      }
      searchBox.addEventListener('change', performSearch);
      searchBox.addEventListener('keyup', function(e) {
        if (e.key === 'Enter') {
          performSearch();
        }
      });
    </script>
</body>
</html>
